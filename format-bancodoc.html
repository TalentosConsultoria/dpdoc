<!-- ===== GUARD: esconde o body enquanto checa auth ===== -->
<style>html[data-auth="checking"] body{visibility:hidden}</style>
<script>document.documentElement.setAttribute('data-auth','checking');</script>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Corrigir CPFs com Base em Relatório</title>

<!-- libs que já usa -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js" defer></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js" defer></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js" defer></script>

<script>
  // Config do seu projeto
  const firebaseConfig = {
    apiKey: "AIzaSyAL8t7tsgoCoNj3nkfUG3mKz0WEpRmH3K8",
    authDomain: "talentosbd-e4206.firebaseapp.com",
    projectId: "talentosbd-e4206",
    storageBucket: "talentosbd-e4206.firebasestorage.app",
    messagingSenderId: "580727253031",
    appId: "1:580727253031:web:5368302ef0da6277788602",
    measurementId: "G-S464LNX2J9"
  };

  // Guard unificado
  window.addEventListener('DOMContentLoaded', () => {
    try { if (!firebase.apps.length) firebase.initializeApp(firebaseConfig); } catch(e) {}
    const auth = firebase.auth();
    auth.onAuthStateChanged(user => {
      if (user) {
        // liberar a página
        document.documentElement.removeAttribute('data-auth');
        document.body.style.visibility = 'visible';
      } else {
        // redirect absoluto (evita problemas de caminho relativo)
        window.location.replace(window.location.origin + "/login.html");
      }
    });
  });
</script>
