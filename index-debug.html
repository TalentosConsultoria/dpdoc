<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DPDoc ‚Äî Debug de Autentica√ß√£o</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;text-align:center;background:#eef3ff;margin:0;padding:40px}
    .card{max-width:860px;margin:0 auto;background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:28px;text-align:left}
    h1{margin:0 0 12px;font-size:24px}
    pre{background:#0b1020;color:#cde3ff;border-radius:12px;padding:14px;overflow:auto}
    .row{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
    a.button,button{background:#2563eb;color:#fff;border:0;border-radius:10px;padding:10px 14px;cursor:pointer;text-decoration:none;display:inline-block}
    .muted{color:#5b6b8c;font-size:14px}
    .ok{color:#16a34a}
    .bad{color:#dc2626}
  </style>
</head>
<body>
  <div class="card">
    <h1>Debug de Autentica√ß√£o ‚Äî DPDoc</h1>
    <div class="muted">Use esta p√°gina apenas para diagnosticar. Ela n√£o fica no menu.</div>
    <div id="state" class="muted" style="margin-top:10px"></div>
    <div class="row">
      <a class="button" href="login.html?return=index.html">For√ßar login e voltar ao index</a>
      <a class="button" href="login.html">Abrir somente o login</a>
      <button id="clear">Limpar sess√£o local</button>
    </div>
    <h3 style="margin-top:24px">Dump</h3>
    <pre id="dump">Carregando‚Ä¶</pre>
  </div>
<script>
(function(){
  const out = [];
  function log(...a){ out.push(a.join(' ')); }
  function dump(){
    document.getElementById('dump').textContent = out.join('\n');
  }
  const st = document.getElementById('state');
  function setState(ok, msg){
    st.innerHTML = (ok ? '‚úÖ ' : '‚ö†Ô∏è ') + msg;
    st.className = ok ? 'ok' : 'bad';
  }

  try {
    log('[time]', new Date().toISOString());
    log('[origin]', location.origin);
    log('[path]', location.pathname + location.search);

    const sess = sessionStorage.getItem('talentos_auth');
    const last = sessionStorage.getItem('talentos_auth_time');
    log('[sessionStorage.talentos_auth]', JSON.stringify(sess));
    log('[sessionStorage.talentos_auth_time]', last);

    const allowed = ["https://dpdoc.talentosconsultoria.com.br"];
    log('[allowedOrigins]', JSON.stringify(allowed));

    if (!allowed.includes(location.origin)){
      setState(false, 'Origem n√£o permitida: ' + location.origin);
      log('blocked due to origin check');
    } else if (!sess) {
      setState(false, 'Sem sess√£o local ‚Äî redirecionando para login‚Ä¶');
      log('no session, will redirect to login.html?return=index.html');
      setTimeout(()=>{ location.href = 'login.html?return=index.html'; }, 800);
    } else {
      setState(true, 'Sess√£o encontrada ‚Äî tudo certo üëç');
      log('session OK, voc√™ deveria ver o index.html normalmente');
    }
  } catch(e){
    setState(false, 'Erro no script: ' + e.message);
    log('[exception]', e.stack || e.message);
  } finally {
    dump();
  }

  document.getElementById('clear').addEventListener('click', ()=>{
    ['talentos_auth','talentos_auth_time'].forEach(k=>sessionStorage.removeItem(k));
    location.reload();
  });
})();
</script>
</body>
</html>
