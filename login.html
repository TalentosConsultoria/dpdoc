<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Acesso Talentos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#eef3ff;margin:0;
         display:flex;align-items:center;justify-content:center;min-height:100vh}
    .card{background:#fff;max-width:520px;width:92%;padding:32px 28px;border-radius:18px;
          box-shadow:0 20px 50px rgba(0,0,0,.12)}
    h1{font-size:28px;margin:0 0 8px;color:#1f3bb3}
    p{color:#3b4250;margin:0 0 18px}
    .hint{font-size:12px;color:#5c6b8a;margin-top:12px}
    .btn{display:inline-block;background:#2563eb;color:#fff;border:0;border-radius:10px;padding:12px 18px;
         font-weight:700;cursor:pointer}
    .hidden{display:none}
    .err{color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;padding:10px;border-radius:8px;margin-top:10px;font-size:13px}
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
</head>
<body>
  <div class="card">
    <h1>Acesso Talentos</h1>
    <p>Você será redirecionado para entrar com sua conta Microsoft.</p>
    <button id="loginBtn" class="btn hidden">Entrar com Microsoft</button>
    <div id="err" class="err hidden"></div>
    <div class="hint">Se não redirecionar automaticamente, clique no botão acima.</div>
  </div>

<script>
(function(){
  const firebaseConfig = {
    apiKey: "AIzaSyAL8t7tsgoCoNj3nkfUG3mKz0WEpRmH3K8",
    authDomain: "talentosbd-e4206.firebaseapp.com",
    projectId: "talentosbd-e4206",
    storageBucket: "talentosbd-e4206.appspot.com",
    messagingSenderId: "580727253031",
    appId: "1:580727253031:web:5363082ef0da6277788602"
  };
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const provider = new firebase.auth.OAuthProvider('microsoft.com');
  provider.setCustomParameters({ domain_hint: 'talentosconsultoria.com.br' });

  const qs = new URLSearchParams(location.search);
  const returnTo = qs.get('return') || 'index.html';
  sessionStorage.setItem('returnTo', returnTo);

  const $btn = document.getElementById('loginBtn');
  const $err = document.getElementById('err');
  const showBtn = ()=> $btn.classList.remove('hidden');
  const showErr = (msg)=>{ $err.textContent = msg; $err.classList.remove('hidden'); showBtn(); };

  const KEY = 'msLoginInProgress';

  auth.onAuthStateChanged(function(user){
    if (user){
      const ret = sessionStorage.getItem('returnTo') || 'index.html';
      location.replace(ret);
    }
  });

  auth.getRedirectResult()
    .then(function(result){
      if (result && result.user){
        sessionStorage.removeItem(KEY);
        const ret = sessionStorage.getItem('returnTo') || 'index.html';
        location.replace(ret);
        return;
      }
      maybeStart();
    })
    .catch(function(e){
      sessionStorage.removeItem(KEY);
      showErr(e && e.message ? e.message : 'Falha ao iniciar login.');
    });

  function start(){
    try{
      sessionStorage.setItem(KEY,'1');
      auth.signInWithRedirect(provider);
    }catch(e){
      sessionStorage.removeItem(KEY);
      showErr(e.message || 'Erro ao redirecionar para login.');
    }
  }

  function maybeStart(){
    const inProgress = sessionStorage.getItem(KEY) === '1';
    if (!inProgress){
      setTimeout(start, 150);
    }else{
      showBtn();
    }
  }

  $btn.addEventListener('click', start);
})();
</script>
</body>
</html>
